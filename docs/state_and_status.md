# Technical Documentation: State & Status Reporting

This document provides a technical overview of the key protobuf messages the robot uses to report its status. Understanding these messages is essential for building any application that monitors the robot's state, position, network health, and work progress.

---

## 1. The Primary Status Message: `report_info_data`

Most of the robot's status is reported through a single, large container message, `report_info_data`, which is defined in `mctrl_sys.proto`. This message is typically requested by the client using the `report_info_cfg` command and is then sent periodically by the robot. It contains several sub-messages, each detailing a specific aspect of the robot's status.

### Message: `report_info_data`

-   **Source:** `mctrl_sys.proto`
-   **Direction:** Robot -> App/Client (`toapp_report_data`)
-   **Purpose:** To provide a comprehensive snapshot of the robot's current state.

#### Key Sub-Messages:

The `report_info_data` message is a container for the following more specific status messages:

| Field Name | Type                 | Description                                    |
| :--------- | :------------------- | :--------------------------------------------- |
| `connect`  | `rpt_connect_status` | Network connection status (WiFi, BLE, Cellular). |
| `dev`      | `rpt_dev_status`     | Core device status (system state, battery, sensors). |
| `rtk`      | `rpt_rtk`            | Detailed RTK GPS status.                       |
| `work`     | `rpt_work`           | Current work/mowing task progress.             |
| `maintain` | `rpt_maintain`       | Maintenance counters (mileage, work time).     |
| `fw_info`  | `device_fw_info`     | Firmware versions of various components.       |

---

### 1.1. Network Status (`rpt_connect_status`)

| Field Name   | Type            | Description                                                                  |
| :----------- | :-------------- | :--------------------------------------------------------------------------- |
| `connect_type` | `int32`         | The type of connection currently active.                                     |
| `ble_rssi`   | `int32`         | The signal strength (RSSI) of the Bluetooth LE connection.                   |
| `wifi_rssi`  | `int32`         | The signal strength (RSSI) of the WiFi connection.                           |
| `mnet_rssi`  | `int32`         | The signal strength (RSSI) of the cellular (MNET) connection.                |
| `used_net`   | `net_used_type` | An enum indicating the primary network being used for data (WiFi or Cellular). |

### 1.2. Device Status (`rpt_dev_status`)

| Field Name      | Type     | Description                                                                                              |
| :-------------- | :------- | :------------------------------------------------------------------------------------------------------- |
| `sys_status`    | `int32`  | The main system status enum (e.g., Mowing, Charging, Paused, Error). The exact enum values are unknown.   |
| `charge_state`  | `int32`  | The state of the charging system (e.g., Charging, Not Charging, Charged).                                |
| `battery_val`   | `int32`  | The battery level as a percentage (0-100).                                                               |
| `sensor_status` | `int64`  | A bitmask representing the status of various sensors (e.g., lift, bumper, rain).                         |
| `lock_state`    | `uint32` | The anti-theft lock state of the device.                                                                 |

### 1.3. RTK GPS Status (`rpt_rtk`)

| Field Name      | Type    | Description                                                                                              |
| :-------------- | :------ | :------------------------------------------------------------------------------------------------------- |
| `status`        | `int32` | The overall status of the RTK system.                                                                    |
| `pos_level`     | `int32` | The quality of the position fix (e.g., 4=RTK Fixed, 5=RTK Float, 1=Standalone).                          |
| `gps_stars`     | `int32` | The number of satellites being tracked by the robot's receiver.                                          |
| `l2_stars`      | `int32` | The number of L2 band satellites being tracked (indicative of high-precision signal).                    |
| `co_view_stars` | `int32` | The number of satellites that are visible to *both* the robot and the base station.                      |
| `age`           | `int32` | The "age" of the last received RTK correction data in seconds. Lower is better.                          |

### 1.4. Work Progress (`rpt_work`)

| Field Name   | Type    | Description                                                              |
| :----------- | :------ | :----------------------------------------------------------------------- |
| `plan`       | `int32` | An enum indicating the type of work being done.                          |
| `progress`   | `int32` | The completion percentage of the current task (0-100).                   |
| `area`       | `int32` | The total area to be mowed in the current task, in square meters.        |
| `path_hash`  | `int64` | The hash of the specific path segment the robot is currently following.  |
| `bp_info`    | `int32` | Information about the last breakpoint (e.g., reason for pausing).        |
| `knife_height` | `int32` | The current cutting height in millimeters.                               |

---

## 2. Other Key Status Messages

While `report_info_data` is the main source of status, other important data points are reported via different, more frequent messages.

### Message: `NavPosUp`

-   **Source:** `mctrl_nav.proto`
-   **Direction:** Robot -> App/Client (`toapp_pos_up`)
-   **Purpose:** To provide a frequent, real-time update of the robot's precise position and orientation. This is the primary message for tracking the robot on a map.

| Field Name | Type    | Description                                                      |
| :--------- | :------ | :--------------------------------------------------------------- |
| `x`, `y`   | `float` | The robot's position in its local coordinate frame (meters).     |
| `status`   | `int32` | The positioning status (likely mirrors `pos_level` from `rpt_rtk`). |
| `toward`   | `int32` | The robot's heading/direction, likely in degrees.                |
| `stars`    | `int32` | The number of satellites currently being used for positioning.     |

### Message: `SysDevErrCode`

-   **Source:** `mctrl_sys.proto`
-   **Direction:** Robot -> App/Client (`toapp_err_code`)
-   **Purpose:** To report a specific error code as it occurs. This is used for immediate notification of critical faults.

| Field Name  | Type    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             - |
| `errorCode` | `int32` | An integer representing the specific error that occurred. A mapping from this code to a human-readable error message would need to be created. |
